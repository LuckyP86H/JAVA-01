# MySQL主从复制原理

## 异步复制

**1、在主库上记录binlog日志。**

每次在事务commit之前，主库将数据更新的事件记录到binlog中。MySQL会按照事务提交的顺序来记录binlog日志，记录binlog日志之后，主库会告诉innodb可以commit了。

**2、从库将主库的binlog日志复制到其本地的relay日志中。**

1）从库会启动一个工作线程，也成为IO线程，IO线程会和主库建立一个普通的客户端连接；

2）主库上启动一个binlog dump线程（转储线程），这个线程会读取主库binlog日志中的事件；（不会轮询，有新的事件才会被唤醒，否则处于睡眠状态）

3）从库的IO线程收到新的事件记录到relaylog中；

4）从库的SQL线程从relaylog中读取事件并且在从库中执行，实现了备份数据的更新。

