# MVCC多版本并发控制

MVCC，Multi-Version Concurrency Control，即多版本并发控制。

## 当前读

像select lock in share mode(共享锁),select for update;update ;insert;delete(排他锁)这些操作都是一种当前读，什么是当前读？就是它读取的是记录的最新版本，读取时还要保证其他并发事务不能修改当前记录，会对读取的记录进行加锁。

## 快照读

像不加锁的select操作就是快照读，即不加锁的非阻塞读；

快照读的前提是隔离级别不是串行级别，串行级别下的快照读会退化为当前读；

之所以出现快照读的情况，是基于提高并发性能的考虑，快照读的是现实基于多版本并发控制，即MVCC。

可以认为MVCC是行锁的一个变种，但是它在很多情况下，避免了加锁的操作，降低了开销；

既然是基于了多版本，即快照读可能读到的并不是数据的最新版本，而有可能是之前的历史版本。

说白了MVCC就是为了实现读写冲突不加锁，而这个读指的就是快照读, 而非当前读，当前读实际上是一种加锁的操作，是悲观锁的实现。

# redo log 重做日志-故障还原

**redo log通常是物理日志，记录的是数据页的物理修改，而不是某一行或某几行修改成怎样怎样，它用来恢复提交后的物理数据页(恢复数据页，且只能恢复到最后一次提交的位置)。**

确保事务的持久性。防止在发生故障的时间点，尚有脏页未写入磁盘，在重启mysql服务的时候，根据redo log进行重做，从而达到事务的持久性这一特性。



# undo log 回滚日志-事务回滚

保存了事务发生之前的数据的一个版本，可以用于回滚，同时可以提供多版本并发控制下的读（MVCC），也即非锁定读



# binlog 二进制日志-主从复制

用于复制，在主从复制中，从库利用主库上的binlog进行重播，实现主从同步。 
用于数据库的基于时间点的还原。